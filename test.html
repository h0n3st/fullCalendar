<!DOCTYPE HTML> 
<html lang='en'> 
	<head> 
		<meta http-equiv='content-type' content='text/html; charset=utf-8'> 

		<title>FullCalendar</title> 
		<link rel='stylesheet' href='node_modules/fullcalendar/dist/fullcalendar.css' />
		<script src='node_modules/jquery/dist/jquery.min.js'></script>
		<script src='node_modules/moment/min/moment.min.js'></script>
		<script src='node_modules/fullcalendar/dist/fullcalendar.js'></script>
		<script src = 'test.js'></script>

		<script>
			const calendar = new Calendar('#calendar');

			const staticEventBuilder = new EventBuilder(calendar, {
				onInitialize: function(event){
					event.setColor('red');
				}
			});

			const dynamicEventBuilder = new EventBuilder(calendar, {
				onClick: function(event, calendar) {
					const initiallySelected = event.isSelected();
					
					calendar.unselectEvents();

					if(!initiallySelected){
						event.select();
					}
				},
				onDrag: function(event, calendar) {
					if(!event.isSelected()) {
						event.revert();
					}
				},
				onResize: function(event, calendar) {
					if(!event.isSelected()) {
						event.revert();
					}
				},
				onSelection: function(event, calendar) {
					event.setColor('green');
				},
				onUnselection: function(event, calendar) {
					event.reinitializeColor();
				},
				onInitialize: function(event, calendar) {
					event.setColor('blue');
					event.setEditable();
				}
			});

			calendar.setCalendarFunctions({
				onSelection: function(calendar, start, end, eventsWithin){
					if(eventsWithin.length === 0) {

						const startDate = new Date(start);
						const endDate = new Date(end);

						if(startDate.getDay() == endDate.getDay()){
							//if no other events are within the start and end
			                const newEvent = dynamicEventBuilder.createEvent(calendar.getHighestEventId() + 1, start, end);
			                calendar.addEvent(newEvent);
						}
		            } 
		            else {
		                calendar.unselectEvents();
		                eventsWithin.forEach((event) => event.select());
		            }
				}
			});

			$(document).ready(function() {

				calendar.addEvent(dynamicEventBuilder.createEvent('3', '2018-02-19 13:10', '2018-02-19 13:30'));
				calendar.addEvent(staticEventBuilder.createEvent('2', '2018-02-19 13:00', '2018-02-19 14:00'));
				calendar.addEvent(dynamicEventBuilder.createEvent('4', '2018-02-19 12:00', '2018-02-19 14:00'));

				const calendarSettings = {
                    header:{
                        left: 'prev,next today',
                        center:'title',
                        right:'listWeek,agendaWeek,agendaDay'
                    },
                    allDaySlot:false,
                    minTime:'9:00',
                    maxTime:'17:00',
                    defaultView:'agendaWeek',
                    businessHours:{
                        dow:[1,2,3,4,5],
                        start:'9:00',
                        end:'17:00'
                    },
                    slotDuration: '00:05:00'

                };
				calendar.print(calendarSettings);
			});
		</script>
	</head> 

	<body> 
		
		<div id='calendar'></div>
	
	</body> 
</html> 
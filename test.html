<!DOCTYPE HTML> 
<html lang="en"> 
	<head> 
		<meta http-equiv="content-type" content="text/html; charset=utf-8"> 

		<title>FullCalendar</title> 
		<link rel='stylesheet' href='node_modules/fullcalendar/dist/fullcalendar.css' />
		<script src='node_modules/jquery/dist/jquery.min.js'></script>
		<script src='node_modules/moment/min/moment.min.js'></script>
		<script src='node_modules/fullcalendar/dist/fullcalendar.js'></script>
		<script src = "test.js"></script>

		<script>
			var calendar = new Calendar("#calendar");

			var abstractBuilder = new EventBuilder(calendar);

			var builder = new EventBuilder(calendar, {
				onClick: function(event, calendar) {
					const initiallySelected = event.isSelected();
					
					calendar.unselectEvents();

					if(!initiallySelected){
						event.select();
					}
					console.log(event.overloadOnActionFunction);
				},
				onDrag: function(event, calendar) {
					if(!event.isSelected()) {
						event.revert();
						event.setColor('red');
					}
				},
				onResize: function(event, calendar) {
					if(!event.isSelected()) {
						event.revert();
						event.setColor('red');
					}
				},
				onSelection: function(event, calendar) {
					event.setColor('green');
					console.log("Selection");
				},
				onUnselection: function(event, calendar) {
					event.reinitializeColor();
					console.log("unselection");
				},
				onInitialize: function(event, calendar) {
					event.setColor("blue");
					event.setEditable();
				}

			});


			calendar.setCalendarFunctions({
				onSelection: function(calendar, start, end, eventsWithin){
					if(eventsWithin.length === 0) {
		                //if no other events are within the start and end
		                const newEvent = builder.createEvent(calendar.getHighestId() + 1, 'test', start, end);
		                calendar.addEvent(newEvent);
		            } 
		            else {
		                calendar.unselectEvents();
		                eventsWithin.forEach((event) => event.select());
		            }
				}
			});

			

			$(document).ready(function() {

				calendar.addEvent(builder.createEvent("3", "Rendez-vous", "2018-02-19 13:10", "2018-02-15 13:30"));
				calendar.addEvent(abstractBuilder.createEvent("2","Abstract Rendez-vous", "2018-02-19 13:00", "2018-02-15 14:00"));

				var jsonData = {
                    header:{
                        left: "prev,next today",
                        center:"title",
                        right:"month,agendaWeek,agendaDay"
                    },
                    allDaySlot:false,
                    minTime:"9:00",
                    maxTime:"17:00",
                    defaultView:"agendaWeek",
                    businessHours:{
                        dow:[1,2,3,4,5],
                        start:"9:00",
                        end:"17:00"
                    }
                };
				calendar.print(jsonData);

				var event = builder.createEvent("4","DOES IT SHOW", "2018-02-19 12:00", "2018-02-15 14:00");
				calendar.addEvent(event);
 		
				calendar.print(); 

				calendar.reprint();

			});
		</script>
	</head> 

	<body> 
		
		<div id='calendar'></div>
	
	</body> 
</html> 